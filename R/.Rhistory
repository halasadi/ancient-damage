axis_ticks_lwd_x = .1,
axis_label_size = 5,
axis_label_face = "bold"))
FactorGGStack(loadings = omega,
annotation = annotation,
palette = cols1,
yaxis_label = "Tissue Type",
order_sample = TRUE,
figure_title = "Factor Loadings Structure Plot (Sparse Loadings)",
legend_labels = NULL,
scale=TRUE,
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 5,
axis_label_face = "bold"))
loadings_sfa <- read.table("../sfa_outputs/GTEX2013_transpose/voom_gtex/gtex_voom_transpose_lambda.out")
omega <- loadings_sfa
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
label = factor(as.character(tissue_labels),
levels=unique(tissue_labels)) )
rownames(omega) <- annotation$sample_id
cols1 <- c(rev(RColorBrewer::brewer.pal(12, "Paired"))[c(3,4,7,8,11,12,5,6,9,10)],
RColorBrewer::brewer.pal(12, "Set3")[c(1,2,5,8,9)],
RColorBrewer::brewer.pal(9, "Set1")[c(9,7)],
RColorBrewer::brewer.pal(8, "Dark2")[c(3,4,8)])
FactorGGStack(loadings = omega,
annotation = annotation,
palette = cols1,
yaxis_label = "Tissue Type",
order_sample = TRUE,
figure_title = "Factor Loadings Structure Plot (Sparse Loadings)",
legend_labels = NULL,
scale=TRUE,
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 5,
axis_label_face = "bold"))
omega <- loadings_sfa
dim(omega)
loadings_sfa <- read.table("../sfa_outputs/GTEX2013_transpose/voom_gtex/gtex_voom_transpose_F.out")
dim(loadings_sfa)
omega <- t(loadings_sfa)
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
label = factor(as.character(tissue_labels),
levels=unique(tissue_labels)) )
rownames(omega) <- annotation$sample_id
cols1 <- c(rev(RColorBrewer::brewer.pal(12, "Paired"))[c(3,4,7,8,11,12,5,6,9,10)],
RColorBrewer::brewer.pal(12, "Set3")[c(1,2,5,8,9)],
RColorBrewer::brewer.pal(9, "Set1")[c(9,7)],
RColorBrewer::brewer.pal(8, "Dark2")[c(3,4,8)])
FactorGGStack(loadings = omega,
annotation = annotation,
palette = cols1,
yaxis_label = "Tissue Type",
order_sample = TRUE,
figure_title = "Factor Loadings Structure Plot (Sparse Loadings)",
legend_labels = NULL,
scale=TRUE,
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 5,
axis_label_face = "bold"))
FactorGGStack(loadings = omega,
annotation = annotation,
palette = cols1,
yaxis_label = "Tissue Type",
order_sample = TRUE,
figure_title = "Factor Loadings Structure Plot (Sparse Factors)",
legend_labels = NULL,
scale=TRUE,
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 5,
axis_label_face = "bold"))
lambda_out <- read.table("../sfa_outputs/Deng2014PPS/voom_deng_counts_lambda.out")
dim(lambda_out)
omega <- lambda_out
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
label = factor(meta_data$cell_type,
levels = c("zy", "early2cell",
"mid2cell", "late2cell","4cell", "8cell", "16cell","earlyblast","midblast","lateblast") ) )
rownames(omega) <- annotation$sample_id
FactorGGplot(loadings = omega,
annotation = annotation,
palette = c(RColorBrewer::brewer.pal(8, "Accent"),RColorBrewer::brewer.pal(4, "Spectral")),
yaxis_label = "Development Phase",
order_sample = TRUE,
figure_title = "Factor Loadings Structure Plot",
legend_labels = NULL,
scale=TRUE,
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
library(flashr)
omega <- lambda_out
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
label = factor(meta_data$cell_type,
levels = c("zy", "early2cell",
"mid2cell", "late2cell","4cell", "8cell", "16cell","earlyblast","midblast","lateblast") ) )
rownames(omega) <- annotation$sample_id
FactorGGStack(loadings = omega,
annotation = annotation,
palette = c(RColorBrewer::brewer.pal(8, "Accent"),RColorBrewer::brewer.pal(4, "Spectral")),
yaxis_label = "Development Phase",
order_sample = TRUE,
figure_title = "Factor Loadings Structure Plot",
legend_labels = NULL,
scale=TRUE,
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
lambda_out <- read.table("../sfa_outputs/Deng2014PPS/voom_deng_counts_lambda.out")
omega <- lambda_out
dim(omega)
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
label = factor(meta_data$cell_type,
levels = c("zy", "early2cell",
"mid2cell", "late2cell","4cell", "8cell", "16cell","earlyblast","midblast","lateblast") ) )
rownames(omega) <- annotation$sample_id
read.data1 = function() {
x = tempfile()
download.file('https://cdn.rawgit.com/kkdey/singleCellRNASeqMouseDeng2014/master/data/Deng2014MouseEsc.rda', destfile=x, quiet=TRUE)
z = get(load((x)))
return(z)
}
Deng2014MouseESC <- read.data1()
deng.counts <- Biobase::exprs(Deng2014MouseESC)
deng.meta_data <- Biobase::pData(Deng2014MouseESC)
deng.gene_names <- rownames(deng.counts)
omega <- lambda_out
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
label = factor(meta_data$cell_type,
levels = c("zy", "early2cell",
"mid2cell", "late2cell","4cell", "8cell", "16cell","earlyblast","midblast","lateblast") ) )
rownames(omega) <- annotation$sample_id
FactorGGStack(loadings = omega,
annotation = annotation,
palette = c(RColorBrewer::brewer.pal(8, "Accent"),RColorBrewer::brewer.pal(4, "Spectral")),
yaxis_label = "Development Phase",
order_sample = TRUE,
figure_title = "Factor Loadings Structure Plot",
legend_labels = NULL,
scale=TRUE,
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
meta_data <- Biobase::pData(Deng2014MouseESC)
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
label = factor(meta_data$cell_type,
levels = c("zy", "early2cell",
"mid2cell", "late2cell","4cell", "8cell", "16cell","earlyblast","midblast","lateblast") ) )
rownames(omega) <- annotation$sample_id
FactorGGStack(loadings = omega,
annotation = annotation,
palette = c(RColorBrewer::brewer.pal(8, "Accent"),RColorBrewer::brewer.pal(4, "Spectral")),
yaxis_label = "Development Phase",
order_sample = TRUE,
figure_title = "Factor Loadings Structure Plot",
legend_labels = NULL,
scale=TRUE,
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
FactorGGStack(loadings = omega[,1:6],
annotation = annotation,
palette = c(RColorBrewer::brewer.pal(8, "Accent"),RColorBrewer::brewer.pal(4, "Spectral")),
yaxis_label = "Development Phase",
order_sample = TRUE,
figure_title = "Factor Loadings Structure Plot",
legend_labels = NULL,
scale=TRUE,
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
FactorGGStack(loadings = omega[,1:10],
annotation = annotation,
palette = c(RColorBrewer::brewer.pal(8, "Accent"),
RColorBrewer::brewer.pal(4, "Spectral")),
yaxis_label = "Development Phase",
order_sample = TRUE,
figure_title = "Factor Loadings Structure Plot",
legend_labels = NULL,
scale=TRUE,
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
FactorGGStack(loadings = omega[,1:6],
annotation = annotation,
palette = c(RColorBrewer::brewer.pal(8, "Accent"),
RColorBrewer::brewer.pal(4, "Spectral")),
yaxis_label = "Development Phase",
order_sample = TRUE,
figure_title = "Factor Loadings Structure Plot",
legend_labels = NULL,
scale=TRUE,
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
FactorGGStack(loadings = omega[,1:6],
annotation = annotation,
palette = c(RColorBrewer::brewer.pal(8, "Accent"),
RColorBrewer::brewer.pal(4, "Spectral")),
yaxis_label = "Development Phase",
order_sample = TRUE,
figure_title = "Factor Loadings Structure Plot (Sparse Loadings)",
legend_labels = NULL,
scale=TRUE,
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
lambda_out <- read.table("../sfa_outputs/Deng2014PPS/voom_deng_counts_transpose_lambda.out")
dim(lambda_out)
lambda_out <- read.table("../sfa_outputs/Deng2014PPS/voom_deng_counts_transpose_F.out")
dim(lambda_out)
omega <- t(lambda_out)
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
label = factor(meta_data$cell_type,
levels = c("zy", "early2cell",
"mid2cell", "late2cell","4cell", "8cell", "16cell","earlyblast","midblast","lateblast") ) )
rownames(omega) <- annotation$sample_id
FactorGGStack(loadings = omega[,1:6],
annotation = annotation,
palette = c(RColorBrewer::brewer.pal(8, "Accent"),
RColorBrewer::brewer.pal(4, "Spectral")),
yaxis_label = "Development Phase",
order_sample = TRUE,
figure_title = "Factor Loadings Structure Plot (Sparse Loadings)",
legend_labels = NULL,
scale=TRUE,
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
FactorGGStack(loadings = omega[,1:6],
annotation = annotation,
palette = c(RColorBrewer::brewer.pal(8, "Accent"),
RColorBrewer::brewer.pal(4, "Spectral")),
yaxis_label = "Development Phase",
order_sample = TRUE,
figure_title = "Factor Loadings Structure Plot (Sparse Factors)",
legend_labels = NULL,
scale=TRUE,
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
setwd("~/Documents/ancient-damage/R")
signature_counts <- get(load("../summary_data/signature-counts-clubbed-Lindo2016.rda"))
dim(signature_counts)
6*4*4*4*4
install.packages("NMF")
library(NMF)
install.extras("NMF")
library(NMF)
meth <- nmfAlgorithm(version = "R")
meth <- c(names(meth), meth)
meth
meth
out <- nmf(signature_counts, K=5, meth, seed=12345)
out <- nmf(signature_counts, K=5, "brunet", seed=12345)
library(NMF)
out <- nmf(signature_counts, K=5, "brunet", seed=12345)
out <- nmf(signature_counts, K=5)
out <- nmf(signature_counts, rank=5)
out
out <- nmf(t(signature_counts), rank=5)
dim(out)
w <- basis(out)
dim(w)
h <- coef(out)
dim(h)
h
hnorm <- apply(h, 1, function(x) return(x/sum(x)))
rowSums(hnorm)
dim(h)
h <- t(coef(out))
dim(h)
hnorm <- apply(h, 1, function(x) return(x/sum(x)))
dim(hnorm)
hnorm <- t(apply(h, 1, function(x) return(x/sum(x))))
rowSums(hnorm)
omega <- hnorm
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
tissue_label = factor(c(rep("Ancient",25), rep("Modern",25)))
)
StructureGGplot(omega = omega,
annotation = annotation,
palette = RColorBrewer::brewer.pal(8, "Accent"),
yaxis_label = "Development Phase",
order_sample = FALSE,
figure_title = paste0("StructurePlot: K=", dim(omega)[2],": pmsignature: with C->T/G->A"),
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
library(NMF)
out <- nmf(t(signature_counts), rank=2)
w <- basis(out)
dim(w)
h <- t(coef(out))
dim(h)
hnorm <- t(apply(h, 1, function(x) return(x/sum(x))))
library(CountClust)
omega <- hnorm
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
tissue_label = factor(c(rep("Ancient",25), rep("Modern",25)))
)
StructureGGplot(omega = omega,
annotation = annotation,
palette = RColorBrewer::brewer.pal(8, "Accent"),
yaxis_label = "Development Phase",
order_sample = FALSE,
figure_title = paste0("StructurePlot: K=", dim(omega)[2],": pmsignature: with C->T/G->A"),
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
library(NMF)
out <- nmf(t(signature_counts), rank=3)
w <- basis(out)
dim(w)
h <- t(coef(out))
dim(h)
hnorm <- t(apply(h, 1, function(x) return(x/sum(x))))
library(CountClust)
omega <- hnorm
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
tissue_label = factor(c(rep("Ancient",25), rep("Modern",25)))
)
StructureGGplot(omega = omega,
annotation = annotation,
palette = RColorBrewer::brewer.pal(8, "Accent"),
yaxis_label = "Moderns/Ancients",
order_sample = FALSE,
figure_title = paste0("NMF StructurePlot: K=", dim(omega)[2],": pmsignature: with C->T/G->A"),
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
library(singleCellRNASeqMouseDeng2014)
library(CountClust)
library(ggplot2)
counts <- exprs(Deng2014MouseESC)
meta_data <- pData(Deng2014MouseESC)
gene_names <- rownames(counts)
dim(counts)
out <- nmf(counts, rank=6)
which(rowSums(counts)==0)
indices <- which(rowSums(counts)==0)
indices
counts <- counts[-indices, ]
dim(counts)
out <- nmf(counts, rank=6)
omega <-  t(apply(t(coef(out)), 1, function(x) return(x/sum(x))))
rowSums(omega)
omega <-  t(apply(t(coef(out)), 1, function(x) return(x/sum(x))))
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
label = factor(meta_data$cell_type,
levels = c("zy", "early2cell",
"mid2cell", "late2cell","4cell", "8cell", "16cell","earlyblast","midblast","lateblast") ) )
rownames(omega) <- annotation$sample_id
StructureGGplot(omega = omega,
annotation = annotation,
palette = RColorBrewer::brewer.pal(8, "Accent"),
yaxis_label = "Development Phase",
order_sample = TRUE,
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
omega <-  t(apply(t(coef(out)), 1, function(x) return(x/sum(x))))
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
tissue_label = factor(rownames(omega),
levels = rev( c("zy", "early2cell",
"mid2cell", "late2cell",
"4cell", "8cell", "16cell",
"earlyblast","midblast",
"lateblast") ) ) )
rownames(omega) <- annotation$sample_id;
StructureGGplot(omega = omega,
annotation = annotation,
palette = RColorBrewer::brewer.pal(8, "Accent"),
yaxis_label = "Development Phase",
order_sample = TRUE,
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
tissue_label = factor(rownames(omega),
levels = rev( c("zy", "early2cell",
"mid2cell", "late2cell",
"4cell", "8cell", "16cell",
"earlyblast","midblast",
"lateblast") ) ) )
rownames(omega) <- annotation$sample_id;
StructureGGplot(omega = omega,
annotation = annotation,
palette = RColorBrewer::brewer.pal(8, "Accent"),
yaxis_label = "Development Phase",
order_sample = TRUE,
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
oega
omega
FactorGGplot(loadings = omega,
annotation = annotation,
palette = c(RColorBrewer::brewer.pal(8, "Accent"),RColorBrewer::brewer.pal(4, "Spectral")),
yaxis_label = "Development Phase",
order_sample = TRUE,
figure_title = "Factor Loadings Structure Plot",
legend_labels = pve_percentage[-1],
scale=TRUE,
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
library(flashr)
FactorGGstack(loadings = omega,
annotation = annotation,
palette = c(RColorBrewer::brewer.pal(8, "Accent"),RColorBrewer::brewer.pal(4, "Spectral")),
yaxis_label = "Development Phase",
order_sample = TRUE,
figure_title = "Factor Loadings Structure Plot",
legend_labels = pve_percentage[-1],
scale=TRUE,
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
FactorGGStack(loadings = omega,
annotation = annotation,
palette = c(RColorBrewer::brewer.pal(8, "Accent"),RColorBrewer::brewer.pal(4, "Spectral")),
yaxis_label = "Development Phase",
order_sample = TRUE,
figure_title = "Factor Loadings Structure Plot",
legend_labels = pve_percentage[-1],
scale=TRUE,
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
label = factor(rownames(omega),
levels = rev( c("zy", "early2cell",
"mid2cell", "late2cell",
"4cell", "8cell", "16cell",
"earlyblast","midblast",
"lateblast") ) ) )
rownames(omega) <- annotation$sample_id;
FactorGGStack(loadings = omega,
annotation = annotation,
palette = c(RColorBrewer::brewer.pal(8, "Accent"),RColorBrewer::brewer.pal(4, "Spectral")),
yaxis_label = "Development Phase",
order_sample = TRUE,
figure_title = "Factor Loadings Structure Plot",
legend_labels = pve_percentage[-1],
scale=TRUE,
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
devtools::install_github("kkdey/CountClust")
