colour=labels)
qplot(PC.PC2, PC.PC3,
data=pc_data_frame_filt,
colour=labels)
plot(pr$center)
sort(pr$rotation[,1], decreasing=TRUE)[1:5]
sort(pr$rotation[,2], decreasing=TRUE)[1:5]
dim(signature_counts)
library(CountClust)
topics_clus <- FitGoM(signature_counts,
tol=0.1,
K=2:4)
save(topics_clus, file="CountClust_output_Lindo2016_with_C_to_T.rda")
omega <- topics_clus$clust_2$omega
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
tissue_label = factor(pc_data_frame$labels)
)
rownames(omega) <- annotation$sample_id;
StructureGGplot(omega = omega,
annotation = annotation,
palette = rev(RColorBrewer::brewer.pal(8, "Accent")),
yaxis_label = "Development Phase",
order_sample = FALSE,
figure_title = paste0("StructurePlot: K=", dim(omega)[2],", no C -> T / G -> A"),
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
theta <- topics_clus$clust_2$theta;
sort(theta[,1])[1:10]
sort(theta[,2])[1:10]
apply(ExtractTopFeatures(theta, top_features = 10, method="poisson", options="min"), c(1,2), function(x) signature_set[x])
omega <- topics_clus$clust_3$omega
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
tissue_label = factor(pc_data_frame$labels)
)
rownames(omega) <- annotation$sample_id;
StructureGGplot(omega = omega,
annotation = annotation,
palette = RColorBrewer::brewer.pal(8, "Accent"),
yaxis_label = "Development Phase",
order_sample = FALSE,
figure_title = paste0("StructurePlot: K=", dim(omega)[2],", no C -> T / G -> A"),
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
theta <- topics_clus$clust_3$theta;
sort(theta[,1])[1:10]
sort(theta[,2])[1:10]
sort(theta[,3])[1:10]
apply(ExtractTopFeatures(theta, top_features = 10, method="poisson", options="min"), c(1,2), function(x) signature_set[x])
omega <- topics_clus$clust_4$omega
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
tissue_label = factor(pc_data_frame$labels)
)
rownames(omega) <- annotation$sample_id;
StructureGGplot(omega = omega,
annotation = annotation,
palette = RColorBrewer::brewer.pal(8, "Accent"),
yaxis_label = "Development Phase",
order_sample = FALSE,
figure_title = paste0("StructurePlot: K=", dim(omega)[2],", no C -> T / G -> A"),
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
theta <- topics_clus$clust_4$theta;
sort(theta[,1])[1:10]
sort(theta[,2])[1:10]
sort(theta[,3])[1:10]
sort(theta[,4])[1:10]
apply(ExtractTopFeatures(theta, top_features = 10, method="poisson", options="min"), c(1,2), function(x) signature_set[x])
sig_split <- do.call(rbind, lapply(colnames(signature_counts), function(x) strsplit(as.character(x), split="")[[1]]))
indices1 <- which(sig_split[,3]=="C" & sig_split[,6]=="T")
indices2 <- which(sig_split[,3]=="G" & sig_split[,6]=="A")
indices2
indices1
union(indices1, indices2)
library(CountClust)
topics_clus <- FitGoM(signature_counts_filter_C_to_T,
tol=0.1,
K=2:4)
save(topics_clus, file="CountClust_output_Lindo2016_without_C_to_T.rda")
topics_clus <- get(load("../rda/CountClust_output_Lindo2016_without_C_to_T.rda"))
##################  clusters:  2 ###################################
omega <- topics_clus$clust_2$omega
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
tissue_label = factor(pc_data_frame$labels)
)
rownames(omega) <- annotation$sample_id;
StructureGGplot(omega = omega,
annotation = annotation,
palette = rev(RColorBrewer::brewer.pal(8, "Accent")),
yaxis_label = "Development Phase",
order_sample = FALSE,
figure_title = paste0("StructurePlot: K=", dim(omega)[2],", no C -> T / G -> A"),
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
theta <- topics_clus$clust_2$theta;
sort(theta[,1])[1:10]
sort(theta[,2])[1:10]
apply(ExtractTopFeatures(theta, top_features = 10, method="poisson", options="min"), c(1,2), function(x) signature_set_filter[x])
signature_set_filter <- colnames(signature_counts_filter_C_to_T)
signature_set_filter
topics_clus <- get(load("../rda/CountClust_output_Lindo2016_without_C_to_T.rda"))
##################  clusters:  2 ###################################
omega <- topics_clus$clust_2$omega
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
tissue_label = factor(pc_data_frame$labels)
)
rownames(omega) <- annotation$sample_id;
StructureGGplot(omega = omega,
annotation = annotation,
palette = rev(RColorBrewer::brewer.pal(8, "Accent")),
yaxis_label = "Development Phase",
order_sample = FALSE,
figure_title = paste0("StructurePlot: K=", dim(omega)[2],", no C -> T / G -> A"),
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
theta <- topics_clus$clust_2$theta;
sort(theta[,1])[1:10]
sort(theta[,2])[1:10]
apply(ExtractTopFeatures(theta, top_features = 10, method="poisson", options="min"), c(1,2), function(x) signature_set_filter[x])
length(signature_set_filter)
ExtractTopFeatures(theta, top_features = 10, method="poisson", options="min")
dim(theta)
library(CountClust)
topics_clus <- FitGoM(signature_counts,
tol=0.1,
K=2:4)
save(topics_clus, file="../rda/CountClust_output_Lindo2016_with_C_to_T.rda")
topics_clus <- get(load("../rda/CountClust_output_Lindo2016_with_C_to_T.rda"));
##############  clusters :  2#######################
omega <- topics_clus$clust_2$omega
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
tissue_label = factor(pc_data_frame$labels)
)
rownames(omega) <- annotation$sample_id;
StructureGGplot(omega = omega,
annotation = annotation,
palette = rev(RColorBrewer::brewer.pal(8, "Accent")),
yaxis_label = "Development Phase",
order_sample = FALSE,
figure_title = paste0("StructurePlot: K=", dim(omega)[2],", no C -> T / G -> A"),
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
theta <- topics_clus$clust_2$theta;
sort(theta[,1])[1:10]
sort(theta[,2])[1:10]
apply(ExtractTopFeatures(theta, top_features = 10, method="poisson", options="min"), c(1,2), function(x) signature_set[x])
################## clusters: 3  ########################
omega <- topics_clus$clust_3$omega
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
tissue_label = factor(pc_data_frame$labels)
)
rownames(omega) <- annotation$sample_id;
StructureGGplot(omega = omega,
annotation = annotation,
palette = RColorBrewer::brewer.pal(8, "Accent"),
yaxis_label = "Development Phase",
order_sample = FALSE,
figure_title = paste0("StructurePlot: K=", dim(omega)[2],", no C -> T / G -> A"),
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
theta <- topics_clus$clust_3$theta;
sort(theta[,1])[1:10]
sort(theta[,2])[1:10]
sort(theta[,3])[1:10]
apply(ExtractTopFeatures(theta, top_features = 10, method="poisson", options="min"), c(1,2), function(x) signature_set[x])
###########  clusters: 4  ###########################
omega <- topics_clus$clust_4$omega
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
tissue_label = factor(pc_data_frame$labels)
)
rownames(omega) <- annotation$sample_id;
StructureGGplot(omega = omega,
annotation = annotation,
palette = RColorBrewer::brewer.pal(8, "Accent"),
yaxis_label = "Development Phase",
order_sample = FALSE,
figure_title = paste0("StructurePlot: K=", dim(omega)[2],", no C -> T / G -> A"),
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
theta <- topics_clus$clust_4$theta;
sort(theta[,1])[1:10]
sort(theta[,2])[1:10]
sort(theta[,3])[1:10]
sort(theta[,4])[1:10]
apply(ExtractTopFeatures(theta, top_features = 10, method="poisson", options="min"), c(1,2), function(x) signature_set[x])
library(CountClust)
topics_clus <- FitGoM(signature_counts_filter_C_to_T,
tol=0.1,
K=2:4)
save(topics_clus, file="../rda/CountClust_output_Lindo2016_without_C_to_T.rda")
topics_clus <- get(load("../rda/CountClust_output_Lindo2016_without_C_to_T.rda"))
##################  clusters:  2 ###################################
omega <- topics_clus$clust_2$omega
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
tissue_label = factor(pc_data_frame$labels)
)
rownames(omega) <- annotation$sample_id;
StructureGGplot(omega = omega,
annotation = annotation,
palette = rev(RColorBrewer::brewer.pal(8, "Accent")),
yaxis_label = "Development Phase",
order_sample = FALSE,
figure_title = paste0("StructurePlot: K=", dim(omega)[2],", no C -> T / G -> A"),
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
theta <- topics_clus$clust_2$theta;
sort(theta[,1])[1:10]
sort(theta[,2])[1:10]
apply(ExtractTopFeatures(theta, top_features = 10, method="poisson", options="min"), c(1,2), function(x) signature_set_filter[x])
################## clusters: 3  ########################
omega <- topics_clus$clust_3$omega
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
tissue_label = factor(pc_data_frame$labels)
)
rownames(omega) <- annotation$sample_id;
StructureGGplot(omega = omega,
annotation = annotation,
palette = RColorBrewer::brewer.pal(8, "Accent"),
yaxis_label = "Development Phase",
order_sample = FALSE,
figure_title = paste0("StructurePlot: K=", dim(omega)[2],", no C -> T / G -> A"),
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
theta <- topics_clus$clust_3$theta;
sort(theta[,1])[1:10]
sort(theta[,2])[1:10]
sort(theta[,3])[1:10]
apply(ExtractTopFeatures(theta, top_features = 10, method="poisson", options="min"), c(1,2), function(x) signature_set_filter[x])
################## clusters: 4  ########################
omega <- topics_clus$clust_4$omega
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
tissue_label = factor(pc_data_frame$labels)
)
rownames(omega) <- annotation$sample_id;
StructureGGplot(omega = omega,
annotation = annotation,
palette = RColorBrewer::brewer.pal(8, "Accent"),
yaxis_label = "Development Phase",
order_sample = FALSE,
figure_title = paste0("StructurePlot: K=", dim(omega)[2],", no C -> T / G -> A"),
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
theta <- topics_clus$clust_4$theta;
sort(theta[,1])[1:10]
sort(theta[,2])[1:10]
sort(theta[,3])[1:10]
sort(theta[,4])[1:10]
apply(ExtractTopFeatures(theta, top_features = 10, method="poisson", options="min"), c(1,2), function(x) signature_set_filter[x])
omega <- topics_clus$clust_3$omega
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
tissue_label = factor(pc_data_frame$labels)
)
rownames(omega) <- annotation$sample_id;
StructureGGplot(omega = omega,
annotation = annotation,
palette = RColorBrewer::brewer.pal(8, "Accent"),
yaxis_label = "Development Phase",
order_sample = FALSE,
figure_title = paste0("StructurePlot: K=", dim(omega)[2],", no C -> T / G -> A"),
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
theta <- topics_clus$clust_3$theta;
sort(theta[,1])[1:10]
sort(theta[,2])[1:10]
sort(theta[,3])[1:10]
apply(ExtractTopFeatures(theta, top_features = 10, method="poisson", options="min"), c(1,2), function(x) signature_set_filter[x])
dim(signature_counts)
library(CountClust)
topics_clus <- FitGoM(signature_counts_filter_C_to_T,
tol=0.1,
K=2:4)
save(topics_clus, file="../rda/CountClust_output_Lindo2016_without_C_to_T.rda")
topics_clus <- get(load("../rda/CountClust_output_Lindo2016_without_C_to_T.rda"))
##################  clusters:  2 ###################################
omega <- topics_clus$clust_2$omega
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
tissue_label = factor(pc_data_frame$labels)
)
rownames(omega) <- annotation$sample_id;
StructureGGplot(omega = omega,
annotation = annotation,
palette = rev(RColorBrewer::brewer.pal(8, "Accent")),
yaxis_label = "Development Phase",
order_sample = FALSE,
figure_title = paste0("StructurePlot: K=", dim(omega)[2],", no C -> T / G -> A"),
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
theta <- topics_clus$clust_2$theta;
sort(theta[,1])[1:10]
sort(theta[,2])[1:10]
apply(ExtractTopFeatures(theta, top_features = 10, method="poisson", options="min"), c(1,2), function(x) signature_set_filter[x])
omega <- topics_clus$clust_3$omega
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
tissue_label = factor(pc_data_frame$labels)
)
rownames(omega) <- annotation$sample_id;
StructureGGplot(omega = omega,
annotation = annotation,
palette = RColorBrewer::brewer.pal(8, "Accent"),
yaxis_label = "Development Phase",
order_sample = FALSE,
figure_title = paste0("StructurePlot: K=", dim(omega)[2],", no C -> T / G -> A"),
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
theta <- topics_clus$clust_3$theta;
sort(theta[,1])[1:10]
sort(theta[,2])[1:10]
sort(theta[,3])[1:10]
apply(ExtractTopFeatures(theta, top_features = 10, method="poisson", options="min"), c(1,2), function(x) signature_set_filter[x])
omega <- topics_clus$clust_4$omega
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(omega))),
tissue_label = factor(pc_data_frame$labels)
)
rownames(omega) <- annotation$sample_id;
StructureGGplot(omega = omega,
annotation = annotation,
palette = RColorBrewer::brewer.pal(8, "Accent"),
yaxis_label = "Development Phase",
order_sample = FALSE,
figure_title = paste0("StructurePlot: K=", dim(omega)[2],", no C -> T / G -> A"),
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
theta <- topics_clus$clust_4$theta;
sort(theta[,1])[1:10]
sort(theta[,2])[1:10]
sort(theta[,3])[1:10]
sort(theta[,4])[1:10]
apply(ExtractTopFeatures(theta, top_features = 10, method="poisson", options="min"), c(1,2), function(x) signature_set_filter[x])
setwd("~/Documents/ancient-damage/R")
signature_counts <- get(load("../summary_data/signature-counts-Lindo2016.rda"))
dim(signature_counts)
sig_split <- do.call(rbind, lapply(colnames(signature_counts), function(x) strsplit(as.character(x), split="")[[1]]))
sig_split
sig_split_red <- sig_split[,3:6];
sig_split_red
strcat(sig_split_red[1,])
paste0(sig_split_red[1,])
sig_split_red[1,]
paste0(sig_split_red[1,], collapse=",")
paste0(sig_split_red[1,], collapse="")
sapply(1:dim(sig_split_red)[1], function(x) paste0(sig_split_red[x,], collapse=""))
substitute_sig <- sapply(1:dim(sig_split_red)[1], function(x) paste0(sig_split_red[x,], collapse=""))
substitute_sig
signature_counts <- get(load("../summary_data/signature-counts-clubbed-Lindo2016.rda"))
sig_split <- do.call(rbind, lapply(colnames(signature_counts), function(x) strsplit(as.character(x), split="")[[1]]))
sig_split_red <- sig_split[,3:6];
substitute_sig <- sapply(1:dim(sig_split_red)[1], function(x) paste0(sig_split_red[x,], collapse=""))
substitute_sig
tapply(signature_counts[1,], substitute_sig, sum)
normalize <- function(x) return(x/sum(x))
normalize(tapply(signature_counts[1,], substitute_sig, sum))
normalize(tapply(signature_counts[2,], substitute_sig, sum))
normalize(tapply(signature_counts[6,], substitute_sig, sum))
normalize(tapply(signature_counts[8,], substitute_sig, sum))
normalize(tapply(signature_counts[9,], substitute_sig, sum))
normalize(tapply(signature_counts[40,], substitute_sig, sum))
normalize(tapply(signature_counts[45,], substitute_sig, sum))
normalize(tapply(signature_counts[33,], substitute_sig, sum))
prop_substitute_sig <- do.call(rbind,
lapply(1:dim(signature_counts)[1], function(x)
normalize(tapply(signature_counts[x,], substitute_sig, sum))))
prop_substitute_sig
dim(prop_substitute_sig)
rowSums(prop_substitute_sig)
prop_substitute_sig <- do.call(rbind,
lapply(1:dim(signature_counts)[1], function(x)
normalize(tapply(signature_counts[x,], substitute_sig, sum))))
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(prop_substitute_sig))),
tissue_label = factor(c(rep("Ancient",25), rep("Modern",25)))
)
rownames(omega) <- annotation$sample_id;
StructureGGplot(omega = prop_substitute_sig,
annotation = annotation,
palette = RColorBrewer::brewer.pal(8, "Accent"),
yaxis_label = "Development Phase",
order_sample = FALSE,
figure_title = paste0("StructurePlot: 6 substituion patterns"),
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
prop_substitute_sig <- do.call(rbind,
lapply(1:dim(signature_counts)[1], function(x)
normalize(tapply(signature_counts[x,], substitute_sig, sum))))
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(prop_substitute_sig))),
tissue_label = factor(c(rep("Ancient",25), rep("Modern",25)))
)
rownames(prop_substitute_sig) <- annotation$sample_id;
StructureGGplot(omega = prop_substitute_sig,
annotation = annotation,
palette = RColorBrewer::brewer.pal(8, "Accent"),
yaxis_label = "Development Phase",
order_sample = FALSE,
figure_title = paste0("StructurePlot: 6 substituion patterns"),
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
prop_substitute_sig[1,]
prop_substitute_sig_filtered <- prop_substitute_sig[,-3]
prop_substitute_sig_filtered[1,]
apply(prop_substitute_sig_filtered, 1, normalize)
t(apply(prop_substitute_sig_filtered, 1, normalize))
prop_substitute_sig_filtered_norm <- t(apply(prop_substitute_sig_filtered, 1, normalize))
rowSums(prop_substitute_sig_filtered_norm)
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(prop_substitute_sig_filtered_norm))),
tissue_label = factor(c(rep("Ancient",25), rep("Modern",25)))
)
rownames(prop_substitute_sig_filtered_norm) <- annotation$sample_id;
StructureGGplot(omega = prop_substitute_sig_filtered_norm,
annotation = annotation,
palette = RColorBrewer::brewer.pal(8, "Accent"),
yaxis_label = "Development Phase",
order_sample = FALSE,
figure_title = paste0("StructurePlot: 5 substituion patterns (without C -> T)"),
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
grep("T->AAA", colnames(signature_counts))
sig_T_AAA_counts <- rowSums(signature_counts[,grep("T->AAA", colnames(signature_counts))])
sig_T_AAA_counts
sig_T_AAA_counts <- rowSums(signature_counts[,grep("T->AAA", colnames(signature_counts))])
sig_counts <- rowSums(signature_counts)
sig_counts
T_AAA_mat <- cbind(sig_T_AAA_counts, sig_counts - sig_T_AAA_counts);
T_AAA_mat <- t(apply(T_AAA_mat, 1, normalize))
rowSums(T_AAA_mat)
annotation <- data.frame(
sample_id = paste0("X", c(1:NROW(T_AAA_mat))),
tissue_label = factor(c(rep("Ancient",25), rep("Modern",25)))
)
rownames(T_AAA_mat) <- annotation$sample_id;
StructureGGplot(omega = T_AAA_mat,
annotation = annotation,
palette = RColorBrewer::brewer.pal(8, "Accent"),
yaxis_label = "Development Phase",
order_sample = FALSE,
figure_title = paste0("StructurePlot: 5 substituion patterns (without C -> T)"),
axis_tick = list(axis_ticks_length = .1,
axis_ticks_lwd_y = .1,
axis_ticks_lwd_x = .1,
axis_label_size = 7,
axis_label_face = "bold"))
barplot(sig_T_AAA_counts/sig_counts)
barplot(sig_T_AAA_counts/sig_counts, main="Prop of T->AAA")
barplot(sig_T_AAA_counts/sig_counts, main="Proportion of T->AAA (each sample)")
