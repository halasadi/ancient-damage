import glob, os

ANCIENT_SAMPLES = [os.path.splitext(x)[0] for x in list(map(os.path.basename, glob.glob("/home/halasadi/ns/ancient_dna_data/bam/*.bam")))]

workdir: "/home/halasadi"

rule all:
    input:
        expand('ancient-damage/csv/{sample}.q30.csv', sample = ANCIENT_SAMPLES)
    
rule call_damage:
    input:
        bam = 'ns/ancient_dna_data/bam/{sample}.bam',
        bai = 'ns/ancient_dna_data/bam/{sample}.bam.bai',
        ref = 'ref/hg19.fa'
    output:
        'ancient-damage/csv/{sample}.q30.csv'
    params:
        nflanking = '2'
    shell:
        'python ancient-damage/bin/generate_summary_data.py -f {input.bam} -o {output}'
        #'python ancient-damage/bin/generate_summary_data_reference_mdw.py -bf {input.bam} -ff {input.ref} -n {params.nflanking} -o {output}'
