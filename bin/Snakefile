import glob, os

ANCIENT_SAMPLES = [os.path.splitext(x)[0] for x in list(map(os.path.basename, glob.glob("/project/mstephens/ancient-damage/data/*.bam")))]

workdir: '/project/mstephens/ancient-damage/'
rule all:
    input:
        expand('csv/{sample}.q30.csv', sample = ANCIENT_SAMPLES)

rule index_bams:
    input:
        bam = 'data/{sample}.bam'
    output:
        bai = 'data/{sample}.bam.bai'
    shell:
        'samtools index {input.bam}'
        
rule call_damage:
    input:
        bam = 'data/{sample}.bam',
        bai = 'data/{sample}.bam.bai'
    output:
        'csv/{sample}.q30.csv'
    shell:
        'python bin/generate_summary_data.py -f {input.bam} -o {output}'

